{% for job in update_jobs %}
	<div id="progress-bar">
	</div>
	{% if job[-1]=='COMPLETE' %}<p>This job has been completed.</p>
  {% else %}<p>This job has progressed to the {{ job[-1] }} station. There are {{ job[3] }} operations remaining.</p>
  {% endif %}
	<p>JOB# {{ job[0] }} <br />
	PO# {{ job[7] }}</p>
  Part#: {{ job[4] }}<br />
	Quantity: {{ job[7] }}<br />
	Description: {{ job[5] }}<br />
	Extended Description:<br />
	<p>{{ job[6]|truncate }}</p>
  <br>
	<script>
	  var steps = ['Pre-Production', 'Laser', 'Bending', 'Welding', 'Assembly', 'Shipping'];
	  var stepWidth = [140, 35, 35, 140, 70, 30, 30];
	  var currentStep = 'Pre-Production';

	  var step = {{ job[-1] }}
	  var colors = { green: '#f77f00', lightGreen: '#20274b ' };
	  var width = stepWidth.reduce((a, b) => a + b, 0);
	  var height = 80, offset = 24;

	  width += offset * 2;
	  height += offset * 2;

	  var svg = d3.select('#progress-bar').append('svg')
	      .attr('id', 'scene', true)
	      .attr('width', width)
	      .attr('height', height)
	      .classed('svg-content', true);

	  var progressBar = svg.append('g')
	                .attr('transform', 'translate(' + offset + ',' + offset + ')')
	                .style('pointer-events', 'none');

	  var progressBackground = progressBar.append('rect')
	      .attr('fill', colors.lightGreen)
	      .attr('height', 8)
	      .attr('width', width - offset * 2)
	      .attr('rx', 4)
	      .attr('ry', 4);

	  var progress = progressBar.append('rect')
	      .attr('fill', colors.green)
	      .attr('height', 8)
	      .attr('width', 0)
	      .attr('rx', 4)
	      .attr('ry', 4);

	  progress.transition()
	      .duration(1000)
	      .attr('width', function(){
	          var index = steps.indexOf(currentStep);
	          var e = 0;
	          var w = 0;
	          while(index > e) { w += stepWidth[e]; e++; }
	          return w;
	      });

	  progressBar.selectAll('circle')
	  .data(steps)
	  .enter()
	  .append('circle')
	  .attr('id', function(d, i){ return 'step_' + i; })
	  .attr('cx', function(d, i){
	    var e = 0;
	    var w = 0;
	    while(i > e) { w += stepWidth[e]; e++; }
	    return w;
	  })
	  .attr('cy', 4)
	  .attr('r', 20)
	  .attr('fill', '#FFFFFF')
	  .attr('stroke', colors.lightGreen)
	  .attr('stroke-width', 6)

	  progressBar.selectAll('text')
	  .data(steps)
	  .enter()
	  .append('text')
	  .attr('id', function(d, i){ return 'label_' + i; })
	  .attr('dx', function(d, i){
	    var e = 0;
	    var w = 0;
	    while(i > e) { w += stepWidth[e]; e++; }
	    return w;
	  })
	  .attr('dy', 10)
	  .attr('text-anchor', 'middle')
	  .text(function(d, i) { return i + 1; })

	  updateProgressBar(steps[step]);

	  //self-running demo
	  //setInterval(function() { updateProgressBar(Math.floor(Math.random() * (steps.length - 1)).toString()); } , 2500)

	  function setupProgressBar(data_){

	  var output = [];
	  for(var i = 0; i < data_.length; i++){ output.push(data_[i].id.toString()); }
	  return output;

	  }

	  function updateProgressBar(step_){

	      progress.transition()
	          .duration(1000)
	          .attr('fill', colors.green)
	          .attr('width', function(){
	              var index = steps.indexOf(step_);
	              var e = 0;
	              var w = 0;
	              while(index > e) { w += stepWidth[e]; e++; }
	              return w;
	          });

	      for(var i = 0; i < steps.length; i++){

	          if(i <= steps.indexOf(step_)) {

	              d3.select('#step_' + i).attr('fill', colors.green).attr('stroke', colors.green);
	              d3.select('#label_' + i).attr('fill', '#FFFFFF');


	          } else {

	              d3.select('#step_' + i).attr('fill', '#FFFFFF').attr('stroke', colors.lightGreen);
	              d3.select('#label_' + i).attr('fill', '#000000');

	          }

	      }
	      if(step_ == 'Complete') {
	        svg.append("text")
	          .attr("x", (width / 2))
	          .attr("y", 70)
	          .attr("text-anchor", "middle")
	          .style("font-size", "18px")
	          .style("fill", "black")
	          .text(step_);
	      } else {
	      svg.append("text")
	        .attr("x", (width / 2))
	        .attr("y", 70)
	        .attr("text-anchor", "middle")
	        .style("font-size", "18px")
	        .style("fill", "black")
	        .text("In Progress: " + step_);
	      }

	  }
	</script>
{% endfor %}
Best regards,<br />
Iconic Metalgear Team<br />
 <br />
***This message was generated automatically***
<script src='http://d3js.org/d3.v4.min.js'></script>
